<?xml version="1.0" encoding="utf-8" ?>

<ContentPage
    x:Class="SuleymaniyeCalendar.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:behaviors="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:models="clr-namespace:SuleymaniyeCalendar.Models"
    xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
    x:DataType="viewModels:SettingsViewModel"
    Title="{localization:Translate Ayarlar}"
    FlowDirection="{DynamicResource FlowDirection}"
    Background="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}">

    <Shell.TitleView>
        <Label Text="{localization:Translate Ayarlar}" Style="{StaticResource TitleLargeStyle}" VerticalTextAlignment="Center" />
    </Shell.TitleView>

    <ContentPage.Content>
        <ScrollView
            Padding="16">
            <VerticalStackLayout Spacing="12">

                <!-- Language Selection -->
                <Border Style="{StaticResource SettingsCard}">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnLanguageCardTapped" />
                    </Border.GestureRecognizers>
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                        <Label Grid.Column="0" Style="{StaticResource IconStyle}" Text="&#xf0ac;" />
                        <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                            <Label Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate UygulamaDili}" />
                            <Label Style="{StaticResource BodySmallStyle}" Text="{Binding SelectedLanguage.Name}" Opacity="0.8" />
                        </VerticalStackLayout>
                        <Label Grid.Column="2" Style="{StaticResource IconStyle}" Text="&#xf054;" FontSize="16" />
                    </Grid>
                </Border>

                <!-- Hidden Picker for Language Selection -->
                <Picker
                    x:Name="LanguagePicker"
                    Title="{localization:Translate UygulamaDiliniSecin}"
                    IsVisible="False"
                    ItemsSource="{Binding SupportedLanguages}"
                    SelectedItem="{Binding SelectedLanguage}" />

                <!-- Theme Selection -->
                <Border Style="{StaticResource SettingsCard}">
                    <VerticalStackLayout Spacing="16">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <Label Grid.Column="0" Style="{StaticResource IconStyle}" Text="&#xf042;" />
                            <Label Grid.Column="1" Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate UygulamaTema}" VerticalOptions="Center" />
                        </Grid>

                        <VerticalStackLayout Spacing="8">
                            <!-- Light Theme -->
                            <Border Style="{StaticResource Chip}">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SetThemeByIndexCommand}" CommandParameter="1" />
                                </Border.GestureRecognizers>
                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                                    <Label Grid.Column="0" Style="{StaticResource IconStyle}" FontSize="16" Text="&#xf185;" />
                                     <Label Grid.Column="1" Text="{localization:Translate AcikTema}" Style="{StaticResource BodyMedium}" VerticalOptions="Center" />
                                    <RadioButton Grid.Column="2" GroupName="ThemeGroup" Value="1" IsChecked="{Binding LightChecked}" />
                                </Grid>
                            </Border>
                            <!-- Dark Theme -->
                            <Border Style="{StaticResource Chip}">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SetThemeByIndexCommand}" CommandParameter="0" />
                                </Border.GestureRecognizers>
                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                                    <Label Grid.Column="0" Style="{StaticResource IconStyle}" FontSize="16" Text="&#xf186;" />
                                     <Label Grid.Column="1" Text="{localization:Translate KoyuTema}" Style="{StaticResource BodyMedium}" VerticalOptions="Center" />
                                    <RadioButton Grid.Column="2" GroupName="ThemeGroup" Value="0" IsChecked="{Binding DarkChecked}" />
                                </Grid>
                            </Border>
                            <!-- System Theme -->
                            <Border Style="{StaticResource Chip}">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding SetThemeByIndexCommand}" CommandParameter="2" />
                                </Border.GestureRecognizers>
                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                                    <Label Grid.Column="0" Style="{StaticResource IconStyle}" FontSize="16" Text="&#xf3ce;" />
                                     <Label Grid.Column="1" Text="{localization:Translate SistemTemasi}" Style="{StaticResource BodyMedium}" VerticalOptions="Center" />
                                    <RadioButton Grid.Column="2" GroupName="ThemeGroup" Value="2" IsChecked="{Binding SystemChecked}" />
                                </Grid>
                            </Border>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Font Size -->
                <Border Style="{StaticResource SettingsCard}">
                    <VerticalStackLayout Spacing="12">
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                            <Label Grid.Column="0" Style="{StaticResource IconStyle}" Text="&#xf031;" />
                            <Label Grid.Column="1" Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate YaziBoyutu}" VerticalOptions="Center" />
                            <Label Grid.Column="2" Text="{Binding FontSize, StringFormat='{0:F0}'}" Style="{StaticResource BodyLargeStyle}" FontAttributes="Bold" />
                        </Grid>
                        
                        <Slider
                            Maximum="24"
                            Minimum="12"
                            Value="{Binding FontSize}" />
                    </VerticalStackLayout>
                </Border>

                <!-- Location Settings -->
                <Border Style="{StaticResource SettingsCard}">
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                        <Label Grid.Column="0" Style="{StaticResource IconStyle}" Text="&#xf3c5;" />
                        <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                            <Label Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate KonumYenileButton}" />
                            <Label Style="{StaticResource BodySmallStyle}" Text="{localization:Translate HepKonumYenile}" Opacity="0.8" />
                        </VerticalStackLayout>
                        <Switch Grid.Column="2" IsToggled="{Binding AlwaysRenewLocationEnabled}" VerticalOptions="Center" />
                    </Grid>
                </Border>

                <!-- Android Notifications -->
                <Border IsVisible="{OnPlatform Android=True, iOS=False}" Style="{StaticResource SettingsCard}">
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                        <Label Grid.Column="0" Style="{StaticResource IconStyle}" Text="&#xf0f3;" />
                        <Label Grid.Column="1" Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate BildirimNamazVakitleri}" VerticalOptions="Center" />
                        <Switch Grid.Column="2" IsToggled="{Binding NotificationPrayerTimesEnabled}" VerticalOptions="Center" IsVisible="{Binding ShowNotificationPrayerOption}" />
                    </Grid>
                </Border>

                <!-- Android Foreground Service -->
                <Border IsVisible="{OnPlatform Android=true, iOS=false}" Style="{StaticResource SettingsCard}">
                    <VerticalStackLayout Spacing="12">
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                            <Label Grid.Column="0" Style="{StaticResource IconStyle}" Text="&#xf1e6;" />
                            <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                                <Label Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate BildirimKapatma}" />
                                <Label Style="{StaticResource BodySmallStyle}" Text="{localization:Translate BildirimUyari}" Opacity="0.8" />
                            </VerticalStackLayout>
                            <Switch Grid.Column="2" IsToggled="{Binding ForegroundServiceEnabled}" VerticalOptions="Center" />
                        </Grid>

                        <Button
                            Style="{StaticResource FilledButton}"
                            Command="{Binding GotoSettingsCommand}"
                            Text="{localization:Translate GotoSettings}" />
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>
    </ContentPage.Content>

</ContentPage>
