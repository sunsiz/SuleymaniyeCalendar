<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SuleymaniyeCalendar.Views.MonthPage"
             xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
             xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
             Title="{Binding Title}" 
             x:DataType="viewModels:MonthViewModel"
             FlowDirection="{DynamicResource FlowDirection}">

<ContentPage.Content>
    <Grid RowDefinitions="*,Auto" Padding="4" RowSpacing="4">

        <!-- Main content area -->
        <Grid Grid.Row="0">
            <!-- Lightweight host; we will inject the heavy table after first frame -->
            <ContentView x:Name="ListHost" />

            <!-- Loading Indicator Overlay - shows above everything when loading -->
            <Grid IsVisible="{Binding IsBusy}" 
                  BackgroundColor="{AppThemeBinding Light={StaticResource BusyOverlayColorDark}, Dark={StaticResource BusyOverlayColor}}"
                  InputTransparent="False">
                <Border Style="{StaticResource Card}" 
                        VerticalOptions="Center" 
                        HorizontalOptions="Center"
                        Padding="40,24"
                        BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceVariantColor}, Dark={StaticResource SurfaceVariantColorDark}}">
                    <VerticalStackLayout Spacing="16" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="{Binding IsBusy}"
                                           Color="{StaticResource PrimaryColor}"
                                           HeightRequest="48"
                                           WidthRequest="48" />
                        <Label Text="{localization:Translate IcerikYukleniyor}"
                               Style="{StaticResource TitleMediumStyle}"
                               HorizontalTextAlignment="Center"
                               TextColor="{StaticResource PrimaryColor}" />
                    </VerticalStackLayout>
                </Border>
            </Grid>
        </Grid>

        <!-- Action Buttons with Border (Android CornerRadius Workaround) -->
        <Grid Grid.Row="1" ColumnDefinitions="*,*,*" ColumnSpacing="12">
            <!-- Close Button -->
            <Border Grid.Column="0"
                    BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceVariantLight}, Dark={StaticResource SurfaceVariantDark}}"
                    Stroke="{AppThemeBinding Light={StaticResource OutlineColor}, Dark={StaticResource OutlineColorDark}}"
                    StrokeThickness="1"
                    Padding="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20" />
                </Border.StrokeShape>
                <Button Text="{localization:Translate Kapat}" 
                        Command="{Binding GoBackCommand}" 
                        BackgroundColor="Transparent"
                        TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariantLight}, Dark={StaticResource OnSurfaceVariantDark}}"
                        FontFamily="OpenSansRegular"
                        FontSize="{DynamicResource BodyFontSize}"
                        FontAttributes="Bold"
                        Padding="16,12" />
            </Border>
            
            <!-- Share Button -->
            <Border Grid.Column="1"
                    IsVisible="{Binding ShowShare}"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Warning60}, Dark={StaticResource Warning30}}"
                    Stroke="Transparent"
                    StrokeThickness="0"
                    Padding="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20" />
                </Border.StrokeShape>
                <Button Text="{localization:Translate Paylas}" 
                        Command="{Binding ShareCommand}" 
                        BackgroundColor="Transparent"
                        TextColor="{AppThemeBinding Light={StaticResource OnWarningColor}, Dark={StaticResource OnWarningColor}}"
                        FontFamily="OpenSansRegular"
                        FontSize="{DynamicResource BodyFontSize}"
                        FontAttributes="Bold"
                        Padding="16,12" />
            </Border>
            
            <!-- Refresh Button with gradient background -->
            <Border Grid.Column="2"
                    Stroke="Transparent"
                    StrokeThickness="0"
                    Padding="0"
                    Background="{StaticResource PrimaryGradientBrush}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20" />
                </Border.StrokeShape>
                <Button Text="{localization:Translate KonumYenileButton}" 
                        Command="{Binding RefreshCommand}" 
                        BackgroundColor="Transparent"
                        TextColor="{AppThemeBinding Light={StaticResource OnPrimaryColor}, Dark={StaticResource OnPrimaryColor}}"
                        FontFamily="OpenSansRegular"
                        FontSize="{DynamicResource BodyFontSize}"
                        FontAttributes="Bold"
                        Padding="16,12"
                        IsEnabled="{Binding IsNotBusy}" />
            </Border>
        </Grid>
    </Grid>
</ContentPage.Content>

</ContentPage>