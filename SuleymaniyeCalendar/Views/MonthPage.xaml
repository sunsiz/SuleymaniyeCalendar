<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SuleymaniyeCalendar.Views.MonthPage"
             xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
             xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
             Title="{Binding Title}" 
             x:DataType="viewModels:MonthViewModel"
             FlowDirection="{DynamicResource FlowDirection}">

<ContentPage.Content>
    <Grid RowDefinitions="*,Auto" Padding="4" RowSpacing="4">

        <!-- Main content area -->
        <Grid Grid.Row="0">
            <!-- Lightweight host; we will inject the heavy table after first frame -->
            <ContentView x:Name="ListHost" />

            <!-- Loading Indicator Overlay - shows above everything when loading -->
            <Grid IsVisible="{Binding IsBusy}" 
                  BackgroundColor="{AppThemeBinding Light={StaticResource BusyOverlayColorDark}, Dark={StaticResource BusyOverlayColor}}"
                  InputTransparent="False">
        <Border Style="{StaticResource GlassCardSoft}" 
            VerticalOptions="Center" 
            HorizontalOptions="Center"
            Padding="40,24">
                    <VerticalStackLayout Spacing="16" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="{Binding IsBusy}"
                                           Color="{StaticResource PrimaryColor}"
                                           HeightRequest="48"
                                           WidthRequest="48" />
                        <Label Text="{localization:Translate IcerikYukleniyor}"
                               Style="{StaticResource TitleMediumStyle}"
                               HorizontalTextAlignment="Center"
                               TextColor="{StaticResource PrimaryColor}" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Optional overlay (reserved for future extended operations) -->
            <Grid IsVisible="{Binding ShowOverlay}" BackgroundColor="#80000000">
                <Border Style="{StaticResource GlassCardSoft}" Padding="32,20" HorizontalOptions="Center" VerticalOptions="Center">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="True" Color="{StaticResource PrimaryColor}" WidthRequest="40" HeightRequest="40" />
                        <Label Text="{Binding OverlayMessage}" Style="{StaticResource BodyLargeStyle}" HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
            </Grid>
        </Grid>

        <!-- Action Buttons with Border (Android CornerRadius Workaround) -->
        <Grid Grid.Row="1" ColumnDefinitions="*,*,*" ColumnSpacing="12">
            <Button Grid.Column="0"
                    Style="{StaticResource GlassButtonOutline}"
                    Text="{localization:Translate Kapat}"
                    Command="{Binding GoBackCommand}" />
            <Button Grid.Column="1"
                    Style="{StaticResource GlassButtonWarning}"
                    IsVisible="{Binding ShowShare}"
                    Text="{localization:Translate Paylas}"
                    Command="{Binding ShareCommand}" />
            <Button Grid.Column="2"
                    Style="{StaticResource GlassButtonPrimary}"
                    Text="{localization:Translate KonumYenileButton}"
                    Command="{Binding RefreshCommand}"
                    IsEnabled="{Binding IsNotBusy}" />
        </Grid>
    </Grid>
</ContentPage.Content>

</ContentPage>