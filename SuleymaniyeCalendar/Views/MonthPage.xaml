<?xml version="1.0" encoding="utf-8"?>

<ContentPage
    x:Class="SuleymaniyeCalendar.Views.MonthPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
    x:DataType="viewModels:MonthViewModel"
    Background="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}"
    FlowDirection="{DynamicResource FlowDirection}"
    Title="{Binding Title}">

    <Shell.TitleView>
        <Label Text="{Binding Title}" Style="{StaticResource TitleLargeStyle}" VerticalTextAlignment="Center" />
    </Shell.TitleView>

    <Grid RowDefinitions="*,Auto" RowSpacing="12" Padding="16,0,16,16">

        <!-- Main content area -->
        <Grid Grid.Row="0">
            <!-- Lightweight host; we will inject the heavy table after first frame -->
            <ContentView x:Name="ListHost" />

            <!-- Loading Indicator Overlay -->
            <Grid IsVisible="{Binding IsBusy}" BackgroundColor="{AppThemeBinding Light=#80FFFFFF, Dark=#80000000}" InputTransparent="False">
                <Border Style="{StaticResource Card}" Padding="32,20" HorizontalOptions="Center" VerticalOptions="Center">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="{Binding IsBusy}" Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                        <Label Text="{localization:Translate IcerikYukleniyor}" Style="{StaticResource TitleMediumStyle}" HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Extended overlay -->
            <Grid IsVisible="{Binding ShowOverlay}" BackgroundColor="{AppThemeBinding Light=#80FFFFFF, Dark=#80000000}">
                <Border Style="{StaticResource Card}" Padding="32,20" HorizontalOptions="Center" VerticalOptions="Center">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="True" Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                        <Label Text="{Binding OverlayMessage}" Style="{StaticResource BodyLargeStyle}" HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
            </Grid>
        </Grid>

        <!-- Action Buttons -->
        <Grid Grid.Row="1" ColumnDefinitions="*,*,*" ColumnSpacing="12">
            <!-- Close Button -->
            <Button
                Grid.Column="0"
                Style="{StaticResource TextButton}"
                Text="{localization:Translate Kapat}"
                Command="{Binding GoBackCommand}" />
            
            <!-- Share Monthly Table Button -->
            <Button
                Grid.Column="1"
                Style="{StaticResource TonalButton}"
                IsVisible="{Binding ShowShare}"
                Text="{localization:Translate Paylas}"
                Command="{Binding ShareCommand}" />
            
            <!-- Refresh Location Button -->
            <Button
                Grid.Column="2"
                Style="{StaticResource FilledButton}"
                Text="{localization:Translate KonumYenileButton}"
                Command="{Binding RefreshCommand}"
                IsEnabled="{Binding IsNotBusy}" />
        </Grid>
    </Grid>

</ContentPage>