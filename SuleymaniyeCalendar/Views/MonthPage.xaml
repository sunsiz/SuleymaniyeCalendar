<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SuleymaniyeCalendar.Views.MonthPage"
             xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
             xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
             Title="{Binding Title}" 
             x:DataType="viewModels:MonthViewModel"
             FlowDirection="{DynamicResource FlowDirection}"
             Background="{AppThemeBinding Light={StaticResource AppBackgroundBrushLight}, Dark={StaticResource AppBackgroundBrushDark}}">


<ContentPage.Content>
    <Grid RowDefinitions="Auto,*,Auto" Padding="0" RowSpacing="0">
        <!-- Premium Hero Card Header -->
        <Border Style="{StaticResource HeroCurrentPrayerCard}" Margin="16,16,16,12" HeightRequest="110" VerticalOptions="Start">
            <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto" Padding="0">
                <!-- Golden Calendar Icon -->
                <Border WidthRequest="56" HeightRequest="56" BackgroundColor="{StaticResource PrimaryColor}" VerticalOptions="Center" HorizontalOptions="Center" Margin="0,0,16,0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="28" />
                    </Border.StrokeShape>
                    <Image VerticalOptions="Center" HorizontalOptions="Center">
                        <Image.Source>
                            <FontImageSource FontFamily="{StaticResource IconFontFamily}" Glyph="&#xf073;" Size="32" Color="White" />
                        </Image.Source>
                    </Image>
                </Border>
                <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                    <Label Text="{Binding MonthYear}" Style="{StaticResource HeadlineLargeStyle}" />
                    <Label Text="{Binding City}" Style="{StaticResource TitleMediumStyle}" TextColor="{StaticResource PrimaryColor}" />
                </VerticalStackLayout>
            </Grid>
        </Border>

        <!-- Main content area -->
        <Grid Grid.Row="1">
            <!-- Lightweight host; we will inject the heavy table after first frame -->
            <ContentView x:Name="ListHost" />

            <!-- Loading Indicator Overlay with ElevatedPrimaryCard -->
            <Grid IsVisible="{Binding IsBusy}" 
                  BackgroundColor="{AppThemeBinding Light={StaticResource BusyOverlayColorDark}, Dark={StaticResource BusyOverlayColor}}"
                  InputTransparent="False">
                <Border Style="{StaticResource ElevatedPrimaryCard}" 
                        VerticalOptions="Center" 
                        HorizontalOptions="Center"
                        Padding="40,24">
                    <VerticalStackLayout Spacing="16" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="{Binding IsBusy}"
                                           Style="{StaticResource GoldenActivityIndicator}"
                                           HeightRequest="48"
                                           WidthRequest="48" />
                        <Label Text="{localization:Translate IcerikYukleniyor}"
                               Style="{StaticResource TitleMediumStyle}"
                               HorizontalTextAlignment="Center"
                               TextColor="{StaticResource PrimaryColor}" />
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Extended overlay with ElevatedPrimaryCard -->
            <Grid IsVisible="{Binding ShowOverlay}" BackgroundColor="#80000000">
                <Border Style="{StaticResource ElevatedPrimaryCard}" Padding="32,20" HorizontalOptions="Center" VerticalOptions="Center">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="True" Style="{StaticResource GoldenActivityIndicator}" WidthRequest="40" HeightRequest="40" />
                        <Label Text="{Binding OverlayMessage}" Style="{StaticResource BodyLargeStyle}" HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
            </Grid>
        </Grid>

        <!-- Action Buttons with Share for Monthly Data Table -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*,*" ColumnSpacing="16" Margin="16,0,16,24">
            <!-- Close Button -->
            <Button Grid.Column="0"
                    Style="{StaticResource ModernButton}"
                    Text="{localization:Translate Kapat}"
                    Command="{Binding GoBackCommand}" />

            <!-- Share Monthly Table Button (opens original website table) -->
            <Button Grid.Column="1"
                    Style="{StaticResource ModernButton}"
                    IsVisible="{Binding ShowShare}"
                    Text="{localization:Translate Paylas}"
                    Command="{Binding ShareCommand}" />

            <!-- Refresh Location Button -->
            <Button Grid.Column="2"
                    Style="{StaticResource ModernButton}"
                    Text="{localization:Translate KonumYenileButton}"
                    Command="{Binding RefreshCommand}"
                    IsEnabled="{Binding IsNotBusy}" />
        </Grid>
    </Grid>
</ContentPage.Content>

</ContentPage>