<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SuleymaniyeCalendar.Views.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:models="clr-namespace:SuleymaniyeCalendar.Models"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
    xmlns:dialogs="clr-namespace:SuleymaniyeCalendar.Views"
    x:Name="MainPageRoot"
    Title="{Binding Title}"
    x:DataType="viewModels:MainViewModel"
    FlowDirection="{DynamicResource FlowDirection}"
    Background="{AppThemeBinding Light={StaticResource AppBackgroundBrushLight}, Dark={StaticResource AppBackgroundBrushDark}}">

    <Shell.TitleView>
        <Grid Margin="10" x:DataType="viewModels:MainViewModel" HeightRequest="40"
              ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
            <Label Grid.Column="0"
                   AutomationProperties.IsInAccessibleTree="True"
                   FontAttributes="Bold"
                   FontSize="{DynamicResource HeaderFontSize}"
                   SemanticProperties.Description="{localization:Translate Takvim}"
                   SemanticProperties.HeadingLevel="Level1"
                   Style="{StaticResource LabelSectionHeader}"
                   Text="{localization:Translate PageTitle}"
                   VerticalTextAlignment="Start" />
            <Image Grid.Column="1"
                   x:DataType="viewModels:MainViewModel"
                   Margin="10,0,12,0"
                   AutomationProperties.IsInAccessibleTree="True"
                   VerticalOptions="Center"
                   SemanticProperties.Description="{localization:Translate UygulamaAyarlari}">
                <Image.Source>
                    <FontImageSource
                        FontAutoScalingEnabled="True"
                        FontFamily="{StaticResource IconFontFamily}"
                        Glyph="&#xf013;"
                        Size="{DynamicResource IconLargeFontSize}"
                        Color="{AppThemeBinding Light=White, Dark={StaticResource OnSurfaceColorDark}}" />
                </Image.Source>
                <Image.GestureRecognizers>
                    <TapGestureRecognizer x:DataType="viewModels:MainViewModel" Command="{Binding SettingsCommand}" NumberOfTapsRequired="1" />
                </Image.GestureRecognizers>
            </Image>
            <Image Grid.Column="2"
                   x:DataType="viewModels:MainViewModel"
                   Margin="10,0,20,0"
                   AutomationProperties.IsInAccessibleTree="True"
                   VerticalOptions="Center"
                   SemanticProperties.Description="{localization:Translate Yenile}">
                <Image.Source>
                    <FontImageSource
                        FontFamily="{StaticResource IconFontFamily}"
                        Glyph="&#xf2f1;"
                        Size="{DynamicResource IconLargeFontSize}"
                        Color="{AppThemeBinding Light=White, Dark={StaticResource OnSurfaceColorDark}}" />
                </Image.Source>
                <Image.GestureRecognizers>
                    <TapGestureRecognizer x:DataType="viewModels:MainViewModel" Command="{Binding RefreshLocationCommand}" NumberOfTapsRequired="1" />
                </Image.GestureRecognizers>
            </Image>
        </Grid>
    </Shell.TitleView>

    <ContentPage.Content>
        <Grid>
            <ScrollView>
                <VerticalStackLayout Spacing="0" Padding="0,8,0,0">

                    <!-- Premium Minimal Location Badge -->
                    <Border Style="{StaticResource MinimalLocationBadge}" HorizontalOptions="Center" Margin="0,0,0,12" Padding="12,4" BackgroundColor="{StaticResource SurfaceVariantColor}" StrokeThickness="1" Stroke="{StaticResource PrimaryColor}">
                        <Grid ColumnDefinitions="Auto,*" VerticalOptions="Center">
                            <Image VerticalOptions="Center" HorizontalOptions="Center" Margin="0,0,8,0">
                                <Image.Source>
                                    <FontImageSource FontFamily="{StaticResource IconFontFamily}" Glyph="&#xf3c5;" Size="18" Color="{StaticResource PrimaryColor}" />
                                </Image.Source>
                            </Image>
                            <Label Text="{Binding City}" Style="{StaticResource LocationStyle}" TextColor="{StaticResource PrimaryColor}" VerticalOptions="Center" />
                        </Grid>
                    </Border>

                    <!-- Premium Hero Card for Current/Next Prayer -->
                    <Border Style="{StaticResource HeroCurrentPrayerCard}" Margin="16,0,16,16" HeightRequest="128" VerticalOptions="Start">
                        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto" Padding="0,0,0,0">
                            <!-- Golden Prayer Icon -->
                            <Border WidthRequest="56" HeightRequest="56" BackgroundColor="{StaticResource PrimaryColor}" VerticalOptions="Center" HorizontalOptions="Center" Margin="0,0,16,0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="28" />
                                </Border.StrokeShape>
                                <Image VerticalOptions="Center" HorizontalOptions="Center">
                                    <Image.Source>
                                        <FontImageSource FontFamily="{StaticResource IconFontFamily}" Glyph="&#xf683;" Size="32" Color="White" />
                                    </Image.Source>
                                </Image>
                            </Border>
                            <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                                <Label Text="{Binding CurrentPrayer.Name}" Style="{StaticResource HeadlineLargeStyle}" />
                                <Label Text="{Binding CurrentPrayer.Description}" Style="{StaticResource BodyLargeStyle}" IsVisible="{Binding CurrentPrayer.Description}" />
                            </VerticalStackLayout>
                            <Label Grid.Column="2" Text="{Binding CurrentPrayer.Time}" Style="{StaticResource TitleLargeStyle}" VerticalOptions="Center" />
                        </Grid>
                    </Border>


                    <!-- Monthly Calendar Navigation Button -->
                    <Button
                        Style="{StaticResource ModernButton}"
                        Margin="32,0,32,12"
                        Text="{localization:Translate AylikTakvim}" 
                            Command="{Binding GoToMonthCommand}" 
                        HorizontalOptions="Fill"/>

                    <!-- Golden Divider -->
                    <BoxView HeightRequest="1.5" Margin="32,0,32,12" Color="{StaticResource PrimaryColor}" Opacity="0.18" />

                    <!-- Animated transition for prayer state (future: add animation triggers) -->

                    <!-- Prayer List -->
                    <CollectionView ItemsSource="{Binding Prayers}" Margin="0,0,0,0"
                                    SelectionMode="None"
                                    Style="{StaticResource ModernListView}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="x:Object">
                                <Border Style="{StaticResource PrayerCard}" Margin="16,6,16,6">
                                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" Padding="0">
                                        <Label Text="{Binding Name}" Style="{StaticResource PrayerNameStyle}" />
                                        <Label Grid.Column="1" Text="{Binding Time}" Style="{StaticResource PrayerTimeStyle}" />
                                        <Label Grid.ColumnSpan="2" Grid.Row="1" Text="{Binding Description}" Style="{StaticResource BodySmallStyle}" IsVisible="{Binding Description}" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </ScrollView>
            <Grid IsVisible="{Binding ShowOverlay}" BackgroundColor="#80000000">
                <Border Style="{StaticResource ElevatedPrimaryCard}" Padding="32,20" HorizontalOptions="Center" VerticalOptions="Center">
                    <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="True" Color="White" WidthRequest="40" HeightRequest="40" />
                        <Label Text="{Binding OverlayMessage}" Style="{StaticResource BodyLargeStyle}" HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </Border>
            </Grid>
            <dialogs:ModernDialog x:Name="GlobalModernDialog" IsVisible="False" />
        </Grid>
    </ContentPage.Content>
</ContentPage>
