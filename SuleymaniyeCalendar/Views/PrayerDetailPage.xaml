<?xml version="1.0" encoding="utf-8" ?>

<ContentPage
    x:Class="SuleymaniyeCalendar.Views.PrayerDetailPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
    x:DataType="viewModels:PrayerDetailViewModel"
    Background="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}"
    FlowDirection="{DynamicResource FlowDirection}"
    Title="{Binding Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:BoolToObjectConverter x:Key="PlayPauseConverter" TrueObject="&#xf04d;" FalseObject="&#xf04b;" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Shell.TitleView>
        <Label Text="{Binding Title}" Style="{StaticResource TitleLargeStyle}" VerticalTextAlignment="Center" />
    </Shell.TitleView>

    <Grid>
        <ScrollView Padding="16">
            <VerticalStackLayout Spacing="12">
                
                <!-- Time & Enable Card -->
                <Border Style="{StaticResource Card}">
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                        <!-- Time Section -->
                        <VerticalStackLayout Grid.Column="0" Spacing="4" VerticalOptions="Center">
                            <Label Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate Vakti}" />
                            <Label Style="{StaticResource HeadlineSmallStyle}" Text="{Binding Time}" />
                        </VerticalStackLayout>
                        
                        <!-- Enable Switch Section -->
                        <VerticalStackLayout Grid.Column="1" HorizontalOptions="End" Spacing="4" VerticalOptions="Center">
                            <Label HorizontalTextAlignment="Center" Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate EtkinlestirSwitch}" />
                            <Switch HorizontalOptions="Center" IsToggled="{Binding Enabled}" />
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <!-- Notification Settings Card -->
                <Border IsVisible="{Binding Enabled}" Style="{StaticResource Card}">
                    <VerticalStackLayout Spacing="16">
                        <!-- Notification Time Section -->
                        <VerticalStackLayout Spacing="12">
                            <VerticalStackLayout Spacing="4">
                                <Label Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate BildirmeZamani}" />
                                <Label>
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Style="{StaticResource BodyLargeStyle}" FontAttributes="Bold" Text="{Binding NotificationTime}" />
                                            <Span Text=" " />
                                            <Span Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate DakikaOnceden}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                            </VerticalStackLayout>
                            
                            <Slider Maximum="60" Minimum="0" Value="{Binding NotificationTime}" />
                        </VerticalStackLayout>

                        <!-- Sound Selection Section -->
                        <VerticalStackLayout Spacing="12">
                            <Label Style="{StaticResource BodyLargeStyle}" Text="{localization:Translate Birsessecin}" />
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                <Picker
                                    Grid.Column="0"
                                    Title="{localization:Translate Birsessecin}"
                                    HorizontalOptions="Fill"
                                    ItemsSource="{Binding AvailableSounds}"
                                    SelectedItem="{Binding SelectedSound}" />
                                <ImageButton Grid.Column="1" Style="{StaticResource IconButton}" Command="{Binding TestButtonClickedCommand}">
                                    <ImageButton.Source>
                                        <FontImageSource FontFamily="{StaticResource IconFontFamily}"
                                                         Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                                         Glyph="{Binding IsPlaying, Converter={StaticResource PlayPauseConverter}}"/>
                                    </ImageButton.Source>
                                </ImageButton>
                            </Grid>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Close Button -->
                <Button
                    Style="{StaticResource FilledButton}"
                    Command="{Binding GoBackCommand}"
                    Text="{localization:Translate Kapat}" />
            </VerticalStackLayout>
        </ScrollView>

        <!-- Scheduling overlay -->
        <Grid IsVisible="{Binding ShowOverlay}" BackgroundColor="{AppThemeBinding Light=#80FFFFFF, Dark=#80000000}">
            <Border Style="{StaticResource Card}" Padding="32,20" HorizontalOptions="Center" VerticalOptions="Center">
                <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                    <ActivityIndicator IsRunning="True" Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                    <Label Text="{Binding OverlayMessage}" Style="{StaticResource BodyLargeStyle}" HorizontalTextAlignment="Center" />
                </VerticalStackLayout>
            </Border>
        </Grid>
    </Grid>

</ContentPage>
