<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SuleymaniyeCalendar.Views.CompassPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
    Title="{Binding Title}"
    x:DataType="viewModels:CompassViewModel">

    <Shell.TitleView>
        <Grid
            Padding="16,0"
            ColumnDefinitions="*,Auto"
            HeightRequest="40">
            <Label
                Grid.Column="0"
                AutomationProperties.IsInAccessibleTree="True"
                Style="{StaticResource LabelSectionHeader}"
                Text="{localization:Translate KibleGostergesi}"
                VerticalOptions="Center" />
            <ImageButton
                Grid.Column="1"
                Command="{Binding RefreshLocationCommand}"
                SemanticProperties.Description="{localization:Translate Yenile}"
                Style="{StaticResource IconButtonStyle}">
                <ImageButton.Source>
                    <FontImageSource
                        FontFamily="{StaticResource IconFontFamily}"
                        Glyph="&#xf2f1;"
                        Size="18" />
                </ImageButton.Source>
            </ImageButton>
        </Grid>
    </Shell.TitleView>

    <ContentPage.Content>
        <Grid>
            <ScrollView>
                <VerticalStackLayout
                    Padding="16"
                    BackgroundColor="{AppThemeBinding Light={StaticResource AppBackgroundColor},
                                                      Dark={StaticResource AppBackgroundColorDark}}"
                    Spacing="20">

                    <!--  Compass Section  -->
                    <Border Style="{StaticResource Card}">
                        <VerticalStackLayout Spacing="16">
                            <Label
                                HorizontalTextAlignment="Center"
                                Style="{StaticResource TitleLargeLabel}"
                                Text="{localization:Translate KibleGostergesi}" />

                            <Grid HeightRequest="300" HorizontalOptions="Center">
                                <Image
                                    x:Name="CompassImage"
                                    Aspect="AspectFit"
                                    HorizontalOptions="Center"
                                    Source="kompas.png"
                                    VerticalOptions="Center" />
                                <Image
                                    x:Name="ImageArrow"
                                    Aspect="AspectFit"
                                    HorizontalOptions="Center"
                                    Rotation="{Binding Heading}"
                                    Scale="0.72"
                                    Source="isaretci.png"
                                    VerticalOptions="Center" />
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                    <!--  Location Information  -->
                    <Border Style="{StaticResource Card}">
                        <VerticalStackLayout Spacing="16">
                            <Label
                                HorizontalTextAlignment="Center"
                                Style="{StaticResource TitleLargeLabel}"
                                Text="{localization:Translate KonumBilgileri}" />

                            <!--  Coordinates Grid  -->
                            <Grid
                                ColumnDefinitions="*,*"
                                ColumnSpacing="20"
                                RowDefinitions="Auto,Auto,Auto"
                                RowSpacing="16">
                                <!--  Latitude  -->
                                <VerticalStackLayout
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    Spacing="6">
                                    <Label
                                        Style="{StaticResource LabelLargeLabel}"
                                        Text="{localization:Translate EnlemFormatsiz}"
                                        FontAttributes="Bold"
                                        TextColor="{AppThemeBinding Light={StaticResource PrimaryColor},
                                                                    Dark={StaticResource PrimaryAccent200Color}}" />
                                    <Label
                                        Style="{StaticResource BodyLargeLabel}"
                                        Text="{Binding Latitude, StringFormat='{}{0:F6}'}"
                                        TextColor="{AppThemeBinding Light={StaticResource Gray700},
                                                                    Dark={StaticResource Gray300}}" />
                                </VerticalStackLayout>

                                <!--  Longitude  -->
                                <VerticalStackLayout
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Spacing="6">
                                    <Label
                                        Style="{StaticResource LabelLargeLabel}"
                                        Text="{localization:Translate BoylamFormatsiz}"
                                        FontAttributes="Bold"
                                        TextColor="{AppThemeBinding Light={StaticResource PrimaryColor},
                                                                    Dark={StaticResource PrimaryAccent200Color}}" />
                                    <Label
                                        Style="{StaticResource BodyLargeLabel}"
                                        Text="{Binding Longitude, StringFormat='{}{0:F6}'}"
                                        TextColor="{AppThemeBinding Light={StaticResource Gray700},
                                                                    Dark={StaticResource Gray300}}" />
                                </VerticalStackLayout>

                                <!--  Altitude  -->
                                <VerticalStackLayout
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Spacing="6">
                                    <Label
                                        Style="{StaticResource LabelLargeLabel}"
                                        Text="{localization:Translate YukseklikFormatsiz}"
                                        FontAttributes="Bold"
                                        TextColor="{AppThemeBinding Light={StaticResource PrimaryColor},
                                                                    Dark={StaticResource PrimaryAccent200Color}}" />
                                    <Label
                                        Style="{StaticResource BodyLargeLabel}"
                                        Text="{Binding Altitude, StringFormat='{}{0:N0} m'}"
                                        TextColor="{AppThemeBinding Light={StaticResource Gray700},
                                                                    Dark={StaticResource Gray300}}" />
                                </VerticalStackLayout>

                                <!--  Heading  -->
                                <VerticalStackLayout
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Spacing="6">
                                    <Label
                                        Style="{StaticResource LabelLargeLabel}"
                                        Text="{localization:Translate Aci}"
                                        FontAttributes="Bold"
                                        TextColor="{AppThemeBinding Light={StaticResource PrimaryColor},
                                                                    Dark={StaticResource PrimaryAccent200Color}}" />
                                    <Label
                                        Style="{StaticResource BodyLargeLabel}"
                                        Text="{Binding Heading, StringFormat='{}{0:F0}°'}"
                                        TextColor="{AppThemeBinding Light={StaticResource Gray700},
                                                                    Dark={StaticResource Gray300}}" />
                                </VerticalStackLayout>

                                <!--  Address - spans both columns  -->
                                <VerticalStackLayout 
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    Grid.ColumnSpan="2"
                                    Spacing="8">
                                    <Label
                                        Style="{StaticResource LabelLargeLabel}"
                                        Text="{localization:Translate Adres}"
                                        FontAttributes="Bold"
                                        TextColor="{AppThemeBinding Light={StaticResource PrimaryColor},
                                                                    Dark={StaticResource PrimaryAccent200Color}}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        MaxLines="3"
                                        Style="{StaticResource BodyLargeLabel}"
                                        Text="{Binding Address}"
                                        TextColor="{AppThemeBinding Light={StaticResource Gray700},
                                                                    Dark={StaticResource Gray300}}" />
                                </VerticalStackLayout>
                            </Grid>

                            <!--  Action Button  -->
                            <Button
                                Command="{Binding GoToMapCommand}"
                                Style="{StaticResource PrimaryButton}"
                                Text="{localization:Translate HaritadaGoster}" />
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </ScrollView>

            <!--  Busy overlay  -->
            <Grid BackgroundColor="#80000000" IsVisible="{Binding IsBusy}">
                <ActivityIndicator
                    HorizontalOptions="Center"
                    IsRunning="True"
                    VerticalOptions="Center"
                    Color="{StaticResource PrimaryColor}" />
            </Grid>
        </Grid>
    </ContentPage.Content>
</ContentPage>