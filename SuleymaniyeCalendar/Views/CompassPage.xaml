<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SuleymaniyeCalendar.Views.CompassPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
    Title="{Binding Title}"
    x:DataType="viewModels:CompassViewModel"
    FlowDirection="{DynamicResource FlowDirection}"
    Background="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}">

    <Shell.TitleView>
        <Label Text="{localization:Translate KibleGostergesi}" Style="{StaticResource TitleLargeStyle}" VerticalTextAlignment="Center" />
    </Shell.TitleView>

    <ContentPage.ToolbarItems>
        <ToolbarItem IconImageSource="{FontImageSource FontFamily={StaticResource IconFontFamily}, Glyph='&#xf2f1;', Color={AppThemeBinding Light={StaticResource OnSurfaceLight}, Dark={StaticResource OnSurfaceDark}}}"
                     Command="{Binding RefreshLocationCommand}"
                     Text="{localization:Translate Yenile}" />
    </ContentPage.ToolbarItems>

    <ContentPage.Content>
        <Grid>
            <ScrollView>
                <VerticalStackLayout Padding="16" Spacing="12">
                    <!-- Compass Section -->
                    <Border Style="{StaticResource Card}">
                        <VerticalStackLayout Spacing="8">
                            <Label
                                HorizontalTextAlignment="Center"
                                Style="{StaticResource TitleLargeStyle}"
                                Text="{localization:Translate KibleGostergesi}" />

                            <Grid HeightRequest="260" HorizontalOptions="Center">
                                <Image
                                    x:Name="CompassImage"
                                    Aspect="AspectFit"
                                    HorizontalOptions="Center"
                                    Source="kompas.png"
                                    VerticalOptions="Center" />
                                <Image
                                    x:Name="ImageArrow"
                                    Aspect="AspectFit"
                                    HorizontalOptions="Center"
                                    Rotation="{Binding Heading}"
                                    Scale="0.72"
                                    Source="isaretci.png"
                                    VerticalOptions="Center" />
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Location Information -->
                    <Border Style="{StaticResource Card}">
                        <VerticalStackLayout Spacing="12">
                            <Label
                                HorizontalTextAlignment="Center"
                                Style="{StaticResource TitleLargeStyle}"
                                Text="{localization:Translate KonumBilgileri}" />

                            <!-- Coordinates Grid -->
                            <Grid
                                ColumnDefinitions="*,*"
                                ColumnSpacing="10"
                                RowDefinitions="Auto,Auto,Auto"
                                RowSpacing="12">
                                <!-- Latitude -->
                                <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource LabelLargeStyle}"
                                        Text="{localization:Translate EnlemFormatsiz}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Latitude, StringFormat='{0:F6}'}" />
                                </VerticalStackLayout>

                                <!-- Longitude -->
                                <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource LabelLargeStyle}"
                                        Text="{localization:Translate BoylamFormatsiz}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Longitude, StringFormat='{0:F6}'}" />
                                </VerticalStackLayout>

                                <!-- Altitude -->
                                <VerticalStackLayout Grid.Row="1" Grid.Column="0" Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource LabelLargeStyle}"
                                        Text="{localization:Translate YukseklikFormatsiz}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Altitude, StringFormat='{0:N0} m'}" />
                                </VerticalStackLayout>

                                <!-- Heading -->
                                <VerticalStackLayout Grid.Row="1" Grid.Column="1" Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource LabelLargeStyle}"
                                        Text="{localization:Translate Aci}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Heading, StringFormat='{0:F0}°'}" />
                                </VerticalStackLayout>

                                <!-- Address -->
                                <VerticalStackLayout
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    Grid.ColumnSpan="2"
                                    Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource TitleMediumStyle}"
                                        Text="{localization:Translate Adres}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Address}" />
                                </VerticalStackLayout>
                            </Grid>

                            <!-- Action Button -->
                            <Button
                                Style="{StaticResource FilledButton}"
                                Command="{Binding GoToMapCommand}"
                                Text="{localization:Translate HaritadaGoster}" />
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </ScrollView>

            <!-- Busy overlay -->
            <Grid BackgroundColor="{AppThemeBinding Light=#80FFFFFF, Dark=#80000000}" IsVisible="{Binding IsBusy}">
                <Border Style="{StaticResource Card}" Padding="32,20" HorizontalOptions="Center" VerticalOptions="Center">
                    <ActivityIndicator IsRunning="True" Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                </Border>
            </Grid>
        </Grid>
    </ContentPage.Content>
</ContentPage>