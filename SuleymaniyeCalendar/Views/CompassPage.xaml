<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="SuleymaniyeCalendar.Views.CompassPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
    Title="{Binding Title}"
    x:DataType="viewModels:CompassViewModel"
    FlowDirection="{DynamicResource FlowDirection}"
    Background="{AppThemeBinding Light={StaticResource AppBackgroundLight}, Dark={StaticResource AppBackgroundDark}}">

    <Shell.TitleView>
        <Grid Margin="8" ColumnDefinitions="*,Auto" ColumnSpacing="8" HeightRequest="48">
            <Label
                Grid.Column="0"
                AutomationProperties.IsInAccessibleTree="True"
                SemanticProperties.HeadingLevel="Level1"
                Style="{StaticResource LabelSectionHeader}"
                Text="{localization:Translate KibleGostergesi}"
                HorizontalTextAlignment="Start" />
            <ImageButton
                Grid.Column="1"
                Margin="10,0,12,0"
                AutomationProperties.IsInAccessibleTree="True"
                VerticalOptions="Center"
                Command="{Binding RefreshLocationCommand}"
                SemanticProperties.Description="{localization:Translate Yenile}">
                <ImageButton.Source>
                    <FontImageSource                        
                        FontAutoScalingEnabled="True"
                        FontFamily="{StaticResource IconFontFamily}"
                        Glyph="&#xf2f1;"
                        Size="{DynamicResource IconLargerFontSize}"
                        Color="{AppThemeBinding Light={StaticResource OnPrimaryColor}, Dark={StaticResource OnPrimaryColorDark}}" />
                </ImageButton.Source>
            </ImageButton>
        </Grid>
    </Shell.TitleView>

    <ContentPage.Content>
        <Grid>
            <ScrollView>
                <VerticalStackLayout Padding="{StaticResource CardMarginCompact}" Spacing="{StaticResource SpacingTight}">
                    <!--  Compass Section  -->
                    <Border Style="{StaticResource FrostGlassCardCrystal}">
                        <VerticalStackLayout Spacing="1">
                            <Label
                                HorizontalTextAlignment="Center"
                                Style="{StaticResource TitleLargeStyle}"
                                TextColor="{AppThemeBinding Light={StaticResource CardValueLight}, Dark={StaticResource CardValueDark}}"
                                Text="{localization:Translate KibleGostergesi}" />
                            <Grid HeightRequest="360" HorizontalOptions="Center" Padding="-10">
                                <Image
                                    x:Name="CompassImage"
                                    Aspect="AspectFit"
                                    HorizontalOptions="Center"
                                    Source="kompas.png"
                                    VerticalOptions="Center" />
                                <Image
                                    x:Name="ImageArrow"
                                    Aspect="AspectFit"
                                    HorizontalOptions="Center"
                                    Rotation="{Binding Heading}"
                                    Scale="0.82"
                                    Source="isaretci.png"
                                    VerticalOptions="Center" />
                            </Grid>
                        </VerticalStackLayout>
                    </Border>

                    <!--  Location Information  -->
                    <Border Style="{StaticResource FrostGlassCardCrystal}">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                HorizontalTextAlignment="Center"
                                Style="{StaticResource TitleLargeStyle}"
                                TextColor="{AppThemeBinding Light={StaticResource CardValueLight}, Dark={StaticResource CardValueDark}}"
                                Text="{localization:Translate KonumBilgileri}" />

                            <!--  Coordinates Grid  -->
                            <Grid
                                ColumnDefinitions="*,*"
                                ColumnSpacing="10"
                                RowDefinitions="Auto,Auto,Auto"
                                RowSpacing="16">
                                <!--  Latitude  -->
                                <VerticalStackLayout
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource LabelLargeStyle}"
                                        Text="{localization:Translate EnlemFormatsiz}"
                                        TextColor="{AppThemeBinding Light={StaticResource CardValueLight},
                                                                    Dark={StaticResource CardValueDark}}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Latitude, StringFormat='{0:F6}'}" />
                                </VerticalStackLayout>

                                <!--  Longitude  -->
                                <VerticalStackLayout
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource LabelLargeStyle}"
                                        Text="{localization:Translate BoylamFormatsiz}"
                                        TextColor="{AppThemeBinding Light={StaticResource CardValueLight},
                                                                    Dark={StaticResource CardValueDark}}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Longitude, StringFormat='{0:F6}'}" />
                                </VerticalStackLayout>

                                <!--  Altitude  -->
                                <VerticalStackLayout
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource LabelLargeStyle}"
                                        Text="{localization:Translate YukseklikFormatsiz}"
                                        TextColor="{AppThemeBinding Light={StaticResource CardValueLight},
                                                                    Dark={StaticResource CardValueDark}}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Altitude, StringFormat='{0:N0} m'}" />
                                </VerticalStackLayout>

                                <!--  Heading  -->
                                <VerticalStackLayout
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource LabelLargeStyle}"
                                        Text="{localization:Translate Aci}"
                                        TextColor="{AppThemeBinding Light={StaticResource CardValueLight},
                                                                    Dark={StaticResource CardValueDark}}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Heading, StringFormat='{0:F0}°'}" />
                                </VerticalStackLayout>

                                <!--  Address - spans both columns  -->
                                <VerticalStackLayout
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    Grid.ColumnSpan="2"
                                    Spacing="4">
                                    <Label
                                        FontAttributes="Bold"
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource TitleMediumStyle}"
                                        Text="{localization:Translate Adres}"
                                        TextColor="{AppThemeBinding Light={StaticResource CardValueLight},
                                                                    Dark={StaticResource CardValueDark}}" />
                                    <Label
                                        HorizontalTextAlignment="Center"
                                        Style="{StaticResource BodyLargeStyle}"
                                        Text="{Binding Address}" />
                                </VerticalStackLayout>
                            </Grid>

                            <!--  Action Button - Glass primary -->
                            <Button
                                Margin="12,4,12,12"
                                Style="{StaticResource VistaAeroGlassButton}"
                                TextColor="{AppThemeBinding Light={StaticResource CardValueLight}, Dark={StaticResource CardValueDark}}"
                                Command="{Binding GoToMapCommand}"
                                Text="{localization:Translate HaritadaGoster}" />
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </ScrollView>

            <!-- 🎨 PHASE 15: Busy overlay with FrostGlassCardCrystal + GoldenActivityIndicator -->
            <Grid BackgroundColor="#80000000" IsVisible="{Binding IsBusy}">
                <Border Style="{StaticResource FrostGlassCardCrystal}" Padding="32,20" HorizontalOptions="Center" VerticalOptions="Center">
                    <ActivityIndicator IsRunning="True" Style="{StaticResource GoldenActivityIndicator}" WidthRequest="80" HeightRequest="80" />
                </Border>
            </Grid>
        </Grid>
    </ContentPage.Content>
</ContentPage>