<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SuleymaniyeCalendar.Views.RadioPage"
             xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
             x:DataType="viewModels:RadioViewModel"
             Title="{Binding Title}">

    <Shell.TitleView>
        <StackLayout Orientation="Horizontal" HeightRequest="34" Margin="10">
            <Label Style="{StaticResource LabelSectionHeader}"
                   Text="{localization:Translate FitratinSesi}"
                   AutomationProperties.IsInAccessibleTree="True" />
        </StackLayout>
    </Shell.TitleView>

    <ContentPage.Content>
        <Grid Margin="0" RowDefinitions="5*,*">
            <Border Grid.Row="0" Padding="0" Margin="0"
                    BackgroundColor="{AppThemeBinding Light={StaticResource AppBackgroundColor}, Dark={StaticResource AppBackgroundColorDark}}">
                <Image Aspect="AspectFit" Opacity="0.7" Source="radyofitrat.png" />
            </Border>

            <Border Grid.Row="1" Margin="0,-25,0,-15" StrokeShape="RoundRectangle 25"
                    BackgroundColor="{AppThemeBinding Light={StaticResource PrimaryAccent100Color}, Dark={StaticResource DarkElevation2dp}}">
                <Grid RowDefinitions="Auto" ColumnDefinitions="*, Auto, *" VerticalOptions="Center" Padding="15,0,15,20">
                    <StackLayout Grid.Row="0" Grid.Column="0" VerticalOptions="Center">
                        <Label VerticalTextAlignment="Center" Style="{DynamicResource LabelStyle}">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="&#xf0ae; " FontFamily="{StaticResource IconFontFamily}"
                                          TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor}, Dark={StaticResource PrimaryAccent50Color}}"
                                          FontSize="20" />
                                    <Span Text="{localization:Translate YayinAkisi}"
                                          TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor}, Dark={StaticResource PrimaryAccent50Color}}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </StackLayout>

                    <!-- Play / Pause control with accessible description -->
                    <Label Grid.Row="0" Grid.Column="1" Padding="0"
                           HorizontalOptions="Center" VerticalOptions="Center"
                           FontAttributes="Bold" FontFamily="{StaticResource IconFontFamily}" FontSize="55" Opacity="0.8"
                           TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor}, Dark={StaticResource PrimaryAccent50Color}}"
                           Text="&#xe038;"
                           AutomationProperties.IsInAccessibleTree="True"
                           SemanticProperties.Description="{localization:Translate RadyoCal}">
                        <Label.Triggers>
                            <DataTrigger Binding="{Binding IsPlaying}" TargetType="Label" Value="False">
                                <Setter Property="Text" Value="&#xf144;" />
                                <Setter Property="SemanticProperties.Description" Value="{localization:Translate RadyoCal}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsPlaying}" TargetType="Label" Value="True">
                                <Setter Property="Text" Value="&#xf28b;" />
                                <Setter Property="SemanticProperties.Description" Value="{localization:Translate Durdur}" />
                            </DataTrigger>
                        </Label.Triggers>
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer NumberOfTapsRequired="1" Command="{Binding PlayCommand}" />
                        </Label.GestureRecognizers>
                    </Label>

                    <StackLayout Grid.Row="0" Grid.Column="2" VerticalOptions="Center">
                        <Label HorizontalTextAlignment="End" VerticalTextAlignment="Center" Style="{DynamicResource LabelStyle}">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="&#xf0ac; " FontFamily="{StaticResource IconFontFamily}"
                                          TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor}, Dark={StaticResource PrimaryAccent50Color}}"
                                          FontSize="20" />
                                    <Span Text="{localization:Translate WebSayfa}"
                                          TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor}, Dark={StaticResource PrimaryAccent50Color}}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </StackLayout>
                </Grid>
            </Border>

            <toolkit:MediaElement x:Name="RadioPlayer"
                                  Grid.Row="1"
                                  Margin="0"
                                  HorizontalOptions="Fill"
                                  VerticalOptions="End"
                                  ShouldShowPlaybackControls="False"
                                  IsVisible="False"
                                  HeightRequest="1"
                                  ShouldAutoPlay="False">
                <toolkit:MediaElement.Triggers>
                    <DataTrigger Binding="{Binding IsPlaying}" TargetType="toolkit:MediaElement" Value="True">
                        <Setter Property="IsVisible" Value="True" />
                        <Setter Property="ShouldAutoPlay" Value="True" />
                        <Setter Property="Source" Value="{Binding RadioStreamUrl}" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsPlaying}" TargetType="toolkit:MediaElement" Value="False">
                        <Setter Property="ShouldAutoPlay" Value="False" />
                        <Setter Property="IsVisible" Value="False" />
                        <Setter Property="Source" Value="{x:Null}" />
                    </DataTrigger>
                </toolkit:MediaElement.Triggers>
            </toolkit:MediaElement>

            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               VerticalOptions="Center" HorizontalOptions="Center"
                               HeightRequest="80" WidthRequest="80"
                               AbsoluteLayout.LayoutFlags="PositionProportional"
                               AbsoluteLayout.LayoutBounds="0.5,0.5,-1,-1"
                               Visual="Material"
                               Color="{StaticResource PrimaryColor}" />
        </Grid>
    </ContentPage.Content>

</ContentPage>