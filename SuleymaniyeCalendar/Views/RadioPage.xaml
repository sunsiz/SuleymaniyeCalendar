<?xml version="1.0" encoding="utf-8" ?>

<ContentPage
    x:Class="SuleymaniyeCalendar.Views.RadioPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
    Title="{Binding Title}"
    x:DataType="viewModels:RadioViewModel"
    FlowDirection="{DynamicResource FlowDirection}"
    Background="{AppThemeBinding Light={StaticResource AppBackgroundLight}, Dark={StaticResource AppBackgroundDark}}">

    <Shell.TitleView>
        <Grid Margin="8,0,8,0" MinimumHeightRequest="48" ColumnDefinitions="*">
            <Label Grid.Column="0"
                AutomationProperties.IsInAccessibleTree="True"
                SemanticProperties.HeadingLevel="Level1"
                Style="{StaticResource LabelSectionHeader}"
                Text="{localization:Translate FitratinSesi}"
                LineBreakMode="TailTruncation"
                HorizontalOptions="Fill"
                HorizontalTextAlignment="Start" />
        </Grid>
    </Shell.TitleView>

    <ContentPage.Content>
        <Grid Margin="0" RowDefinitions="5*,*">
            <Border
                Grid.Row="0"
                Margin="0"
                Padding="0"
                StrokeThickness="0"
                Stroke="Transparent"
                Background="Transparent">
                <!-- BackgroundColor="{AppThemeBinding Light={StaticResource AppBackgroundColor},
                                                  Dark={StaticResource AppBackgroundColorDark}}" -->
                <Image
                    Aspect="AspectFit"
                    Opacity="0.7"
                    Source="radyofitrat.png" />
            </Border>

            <Border
                Style="{StaticResource FrostGlassCardCrystal}"
                Grid.Row="1"
                Margin="0,-25,0,-15">
                <Grid
                    Padding="{StaticResource CardPaddingDefault}"
                    ColumnDefinitions="*, Auto, *"
                    RowDefinitions="Auto"
                    ColumnSpacing="{StaticResource SpacingLG}"
                    VerticalOptions="Center">
                    <StackLayout
                        Grid.Row="0"
                        Grid.Column="0"
                        VerticalOptions="Center">
                        <Label Style="{DynamicResource LabelStyle}" VerticalTextAlignment="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span
                                        FontFamily="{StaticResource IconFontFamily}"
                                        FontSize="{DynamicResource IconLargeFontSize}"
                                        Text="&#xf0ae; "
                                        TextColor="{AppThemeBinding Light={StaticResource CardValueLight},
                                                                    Dark={StaticResource CardValueDark}}" />
                                    <Span 
                                        Text="{localization:Translate YayinAkisi}" 
                                        FontSize="{DynamicResource BodyFontSize}"
                                        TextColor="{AppThemeBinding Light={StaticResource CardValueLight}, Dark={StaticResource CardValueDark}}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                        <StackLayout.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding TapCommand}" CommandParameter="https://www.instagram.com/radyofitrat/" />
                        </StackLayout.GestureRecognizers>
                    </StackLayout>

                    <!--  Enhanced Play / Pause control with circular, elegant design  -->
                    <Border
                        Grid.Row="0"
                        Grid.Column="1"
                        Style="{StaticResource LuminousCircularIcon}"
                        HorizontalOptions="Center"
                        VerticalOptions="Center">         
                        <!-- Stroke="{AppThemeBinding Light={StaticResource Primary60}, Dark={StaticResource Primary30}}"
                        StrokeThickness="3" -->               
                        <Border.Shadow>
                            <Shadow Brush="{AppThemeBinding Light={StaticResource Primary60}, Dark={StaticResource Primary30}}"
                                    Radius="16"
                                    Opacity="0.1"
                                    Offset="0,2" />
                        </Border.Shadow>
                        <Label
                            Margin="0"
                            Padding="0,0,0,0"
                            AutomationProperties.IsInAccessibleTree="True"
                            FontAttributes="Bold"
                            FontFamily="{StaticResource IconFontFamily}"
                            FontSize="{DynamicResource IconXLFontSize}"
                            HorizontalOptions="Center"
                            HorizontalTextAlignment="Center"
                            VerticalTextAlignment="Center"
                            SemanticProperties.Description="{localization:Translate RadyoCal}"
                            Text="&#xf144;"
                            TextColor="{AppThemeBinding Light={StaticResource Primary60}, Dark={StaticResource Primary30}}"
                            VerticalOptions="Center">
                            <Label.Triggers>
                                <!-- Show pause icon when Playing (bound directly to MediaElement.CurrentState) -->
                                <DataTrigger TargetType="Label" x:DataType="toolkit:MediaElement"
                                    Binding="{Binding Source={x:Reference RadioPlayer}, Path=CurrentState}"
                                    Value="{x:Static toolkit:MediaElementState.Playing}">
                                    <Setter Property="Text" Value="&#xf28b;" />
                                    <Setter Property="SemanticProperties.Description" Value="{localization:Translate Durdur}" />
                                    <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource Warning60}, Dark={StaticResource Warning30}}" />
                                </DataTrigger>
                                <!-- Show loading icon when Buffering
                                <DataTrigger TargetType="Label"
                                    Binding="{Binding Source={x:Reference RadioPlayer}, Path=CurrentState}"
                                    Value="{x:Static toolkit:MediaElementState.Buffering}">
                                    <Setter Property="Text" Value="&#xf110;" />
                                    <Setter Property="SemanticProperties.Description" Value="Loading" />
                                    <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource Primary40}, Dark={StaticResource Primary50}}" />
                                </DataTrigger> -->
                                <!-- Show loading icon when Opening -->
                                <DataTrigger TargetType="Label" x:DataType="toolkit:MediaElement"
                                    Binding="{Binding Source={x:Reference RadioPlayer}, Path=CurrentState}"
                                    Value="{x:Static toolkit:MediaElementState.Opening}">
                                    <Setter Property="Text" Value="&#xf110;" />
                                    <Setter Property="SemanticProperties.Description" Value="Loading" />
                                    <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource Primary40}, Dark={StaticResource Primary50}}" />
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding PlayCommand}" NumberOfTapsRequired="1" />
                        </Border.GestureRecognizers>
                    </Border>

                    <StackLayout
                        Grid.Row="0"
                        Grid.Column="2"
                        VerticalOptions="Center">
                        <Label
                            HorizontalTextAlignment="End"
                            Style="{DynamicResource LabelStyle}"
                            VerticalTextAlignment="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span
                                        FontFamily="{StaticResource IconFontFamily}"
                                        FontSize="{DynamicResource IconLargeFontSize}"
                                        Text="&#xf0ac; "
                                        TextColor="{AppThemeBinding Light={StaticResource CardValueLight},
                                                                    Dark={StaticResource CardValueDark}}" />
                                    <Span 
                                        Text="{localization:Translate WebSayfa}" 
                                        FontSize="{DynamicResource BodyFontSize}"
                                        TextColor="{AppThemeBinding Light={StaticResource CardValueLight}, Dark={StaticResource CardValueDark}}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                        <StackLayout.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding TapCommand}" CommandParameter="https://www.fitratradyo.com/" />
                        </StackLayout.GestureRecognizers>
                    </StackLayout>
                </Grid>
            </Border>

            <toolkit:MediaElement
                x:Name="RadioPlayer"
                Grid.Row="1"
                Margin="0"
                AndroidViewType="TextureView"
                HeightRequest="1"
                HorizontalOptions="Fill"
                IsVisible="False"
                MetadataArtist="{localization:Translate SuleymaniyeVakfi}"
                MetadataArtworkUrl="https://www.fitratradyo.com/img/fitrat_radyo.png"
                MetadataTitle="{localization:Translate RadyoFitrat}"
                ShouldAutoPlay="False"
                ShouldMute="False"
                ShouldShowPlaybackControls="False"
                VerticalOptions="End" />

            <!-- Busy overlay - bound directly to MediaElement.CurrentState (Microsoft best practice) -->
            <Grid x:Name="BusyOverlay" IsVisible="False">
                <Grid.Triggers>
                    <!-- Show loading indicator when Buffering -->
                    <DataTrigger TargetType="Grid" x:DataType="toolkit:MediaElement"
                                 Binding="{Binding Source={x:Reference RadioPlayer}, Path=CurrentState}"
                                 Value="{x:Static toolkit:MediaElementState.Buffering}">
                        <Setter Property="IsVisible" Value="True" />
                    </DataTrigger>
                    <!-- Show loading indicator when Opening -->
                    <DataTrigger TargetType="Grid" x:DataType="toolkit:MediaElement"
                                 Binding="{Binding Source={x:Reference RadioPlayer}, Path=CurrentState}"
                                 Value="{x:Static toolkit:MediaElementState.Opening}">
                        <Setter Property="IsVisible" Value="True" />
                    </DataTrigger>
                </Grid.Triggers>
                <ActivityIndicator IsRunning="True" Style="{StaticResource GoldenActivityIndicator}" WidthRequest="80" HeightRequest="80" />
            </Grid>
        </Grid>
    </ContentPage.Content>

</ContentPage>
