<?xml version="1.0" encoding="utf-8" ?>

<ContentPage
    x:Class="SuleymaniyeCalendar.Views.RadioPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:localization="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewModels="clr-namespace:SuleymaniyeCalendar.ViewModels"
    Title="{Binding Title}"
    x:DataType="viewModels:RadioViewModel"
    FlowDirection="{DynamicResource FlowDirection}">

    <Shell.TitleView>
        <StackLayout
            Margin="10"
            HeightRequest="34"
            Orientation="Horizontal">
            <Label
                AutomationProperties.IsInAccessibleTree="True"
                Style="{StaticResource LabelSectionHeader}"
                Text="{localization:Translate FitratinSesi}" />
        </StackLayout>
    </Shell.TitleView>

    <ContentPage.Content>
        <Grid Margin="0" RowDefinitions="5*,*">
            <Border
                Grid.Row="0"
                Margin="0"
                Padding="0"
                BackgroundColor="{AppThemeBinding Light={StaticResource AppBackgroundColor},
                                                  Dark={StaticResource AppBackgroundColorDark}}">
                <Image
                    Aspect="AspectFit"
                    Opacity="0.7"
                    Source="radyofitrat.png" />
            </Border>

            <Border
                Style="{StaticResource MediaCard}"
                Grid.Row="1"
                Margin="0,-25,0,-15"
                StrokeShape="RoundRectangle 25">
                <Grid
                    Padding="15,0,15,20"
                    ColumnDefinitions="*, Auto, *"
                    RowDefinitions="Auto"
                    VerticalOptions="Center">
                    <StackLayout
                        Grid.Row="0"
                        Grid.Column="0"
                        VerticalOptions="Center">
                        <Label Style="{DynamicResource LabelStyle}" VerticalTextAlignment="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span
                                        FontFamily="{StaticResource IconFontFamily}"
                                        FontSize="20"
                                        Text="&#xf0ae; "
                                        TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor},
                                                                    Dark={StaticResource PrimaryAccent50Color}}" />
                                    <Span Text="{localization:Translate YayinAkisi}" TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor}, Dark={StaticResource PrimaryAccent50Color}}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                        <StackLayout.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding TapCommand}" CommandParameter="https://www.instagram.com/radyofitrat/" />
                        </StackLayout.GestureRecognizers>
                    </StackLayout>

                    <!--  Play / Pause control with accessible description  -->
                    <Label
                        Grid.Row="0"
                        Grid.Column="1"
                        Padding="0"
                        AutomationProperties.IsInAccessibleTree="True"
                        FontAttributes="Bold"
                        FontFamily="{StaticResource IconFontFamily}"
                        FontSize="55"
                        HorizontalOptions="Center"
                        Opacity="0.8"
                        SemanticProperties.Description="{localization:Translate RadyoCal}"
                        Text="&#xe038;"
                        TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor},
                                                    Dark={StaticResource PrimaryAccent50Color}}"
                        VerticalOptions="Center">
                        <Label.Triggers>
                            <DataTrigger
                                Binding="{Binding IsPlaying}"
                                TargetType="Label"
                                Value="False">
                                <Setter Property="Text" Value="&#xf144;" />
                                <Setter Property="SemanticProperties.Description" Value="{localization:Translate Oynat}" />
                            </DataTrigger>
                            <DataTrigger
                                Binding="{Binding IsPlaying}"
                                TargetType="Label"
                                Value="True">
                                <Setter Property="Text" Value="&#xf28b;" />
                                <Setter Property="SemanticProperties.Description" Value="{localization:Translate Durdur}" />
                            </DataTrigger>
                        </Label.Triggers>
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding PlayCommand}" NumberOfTapsRequired="1" />
                        </Label.GestureRecognizers>
                    </Label>

                    <StackLayout
                        Grid.Row="0"
                        Grid.Column="2"
                        VerticalOptions="Center">
                        <Label
                            HorizontalTextAlignment="End"
                            Style="{DynamicResource LabelStyle}"
                            VerticalTextAlignment="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span
                                        FontFamily="{StaticResource IconFontFamily}"
                                        FontSize="20"
                                        Text="&#xf0ac; "
                                        TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor},
                                                                    Dark={StaticResource PrimaryAccent50Color}}" />
                                    <Span Text="{localization:Translate WebSayfa}" TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkColor}, Dark={StaticResource PrimaryAccent50Color}}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                        <StackLayout.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding TapCommand}" CommandParameter="https://www.radyofitrat.com/" />
                        </StackLayout.GestureRecognizers>
                    </StackLayout>
                </Grid>
            </Border>

            <toolkit:MediaElement
                x:Name="RadioPlayer"
                Grid.Row="1"
                Margin="0"
                AndroidViewType="TextureView"
                HeightRequest="1"
                HorizontalOptions="Fill"
                IsVisible="False"
                MetadataArtist="{localization:Translate SuleymaniyeVakfi}"
                MetadataArtworkUrl="https://www.radyofitrat.com/img/radyo-fitrat.png"
                MetadataTitle="{localization:Translate RadyoFitrat}"
                ShouldAutoPlay="False"
                ShouldMute="False" CurrentState="Buffering"
                ShouldShowPlaybackControls="False"
                Source="https://www.suleymaniyevakfi.org/radio.mp3"
                VerticalOptions="End" />

            <ActivityIndicator
                AbsoluteLayout.LayoutBounds="0.5,0.5,-1,-1"
                AbsoluteLayout.LayoutFlags="PositionProportional"
                HeightRequest="80"
                HorizontalOptions="Center"
                IsRunning="{Binding IsBusy}"
                VerticalOptions="Center"
                Visual="Material"
                WidthRequest="80"
                Color="{StaticResource PrimaryColor}" />
        </Grid>
    </ContentPage.Content>

</ContentPage>